unit fMovementGraphics;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, fBase, uMovement, VclTee.TeeGDIPlus, Data.DB, VCLTee.TeEngine, VCLTee.Series,
  Vcl.ExtCtrls, VCLTee.TeeProcs, VCLTee.Chart, VCLTee.DBChart, Vcl.ComCtrls;

type
  TfrmMovementGraphics = class(TfrmBase)
    dtsFormPaymentsExpenses: TDataSource;
    pnlTitle: TPanel;
    pnlBottom: TPanel;
    pgcGeneral: TPageControl;
    tabGraphics: TTabSheet;
    tabLists: TTabSheet;
    tabTotals: TTabSheet;
    scrGraphics: TScrollBox;
    chtFormPaymentsRevenues: TDBChart;
    Series1: TPieSeries;
    chtFormPaymentsExpenses: TDBChart;
    PieSeries1: TPieSeries;
    dtsFormPaymentsRevenues: TDataSource;
    procedure FormShow(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
  private
    FMovement: TMovement;
    { Private declarations }
  public
    { Public declarations }
    property Movement: TMovement read FMovement write FMovement;
  end;

var
  frmMovementGraphics: TfrmMovementGraphics;

implementation

{$R *.dfm}

procedure TfrmMovementGraphics.FormCreate(Sender: TObject);
begin
  inherited;
  FMovement := TMovement.Create;
end;

procedure TfrmMovementGraphics.FormDestroy(Sender: TObject);
begin
  inherited;
  FMovement.Free;
end;

procedure TfrmMovementGraphics.FormShow(Sender: TObject);
var
  I:Integer;
  lDescription: string;
begin
  inherited;

  I:=0;
  lDescription := EmptyStr;
  chtFormPaymentsExpenses.Series[0].Clear;
  dtsFormPaymentsExpenses.DataSet := FMovement.QueryFormPaymentsExpenses;
  FMovement.GetQueryFormPaymentsExpenses;

  if not (FMovement.QueryFormPaymentsExpenses.IsEmpty) then
  begin
    FMovement.QueryFormPaymentsExpenses.First;
    while not FMovement.QueryFormPaymentsExpenses.Eof do
    begin
      lDescription := FMovement.QueryFormPaymentsExpenses.FieldByName('name').AsAnsiString;
      chtFormPaymentsExpenses.Series[0].Add(
        FMovement.QueryFormPaymentsExpenses.FieldByName('total').AsCurrency,
        ' ' + lDescription,
        RGB(Random(255), Random(255), Random(255)));
      FMovement.QueryFormPaymentsExpenses.Next;
    end;
  end;
  chtFormPaymentsExpenses.Series[0].Marks.Visible := false;

  chtFormPaymentsRevenues.Series[0].Clear;
  dtsFormPaymentsRevenues.DataSet := FMovement.QueryFormPaymentsRevenues;
  FMovement.GetQueryFormPaymentsRevenues;

  if not (FMovement.QueryFormPaymentsRevenues.IsEmpty) then
  begin
    FMovement.QueryFormPaymentsRevenues.First;
    while not FMovement.QueryFormPaymentsRevenues.Eof do
    begin
      lDescription := FMovement.QueryFormPaymentsRevenues.FieldByName('name').AsAnsiString;
      chtFormPaymentsRevenues.Series[0].Add(
        FMovement.QueryFormPaymentsRevenues.FieldByName('total').AsCurrency,
        ' ' + lDescription,
        RGB(Random(255), Random(255), Random(255)));
      FMovement.QueryFormPaymentsRevenues.Next;
    end;
  end;
  chtFormPaymentsRevenues.Series[0].Marks.Visible := false;

end;

end.
